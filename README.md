# ZalupaSPB

## Описание проекта
ZalupaSPB - система управления доступом к сервисам через инвайты и ключи с интеграцией Discord. Основные возможности:

- Регистрация пользователей только по инвайтам от существующих пользователей
- Генерация и активация ключей доступа с разными сроками действия
- Интеграция с Discord для синхронизации ролей и управления доступом
- Система квот инвайтов в зависимости от роли пользователя
- Полное логирование действий пользователей
- Загрузка и управление версиями лоадера

## Архитектура
Проект состоит из следующих компонентов:
- Веб-приложение (Django + DRF)
- Discord-бот (discord.py)
- Единая база данных (PostgreSQL)
- Система кеширования (Redis)
- WebSocket для обновлений в реальном времени

## Структура проекта
```
zalupaspb/
├── web/                   # Django веб-приложение
│   ├── zalupaspb/         # Основной проект Django
│   ├── users/             # Приложение для работы с пользователями
│   ├── keys/              # Приложение для работы с ключами
│   ├── invites/           # Приложение для работы с инвайтами
│   └── logs/              # Приложение для логирования
├── bot/                   # Discord бот
│   ├── bot.py             # Основной файл бота
│   └── api_client.py      # Клиент для работы с API
├── config/                # Конфигурационные файлы
│   ├── config.yaml        # Основная конфигурация
│   └── .env               # Переменные окружения
├── docs/                  # Документация
└── scripts/               # Скрипты для установки и управления
    └── init.sh            # Скрипт инициализации
```

## Функциональность

### Система авторизации
- Регистрация только по инвайтам от существующих пользователей
- Лимиты инвайтов зависят от роли пользователя:
  - Админы: неограниченно
  - Модераторы: 10 инвайтов в месяц
  - Пользователи: 2 инвайта в месяц
- Привязка Discord-аккаунта через временный код
- Авторизация на сайте через логин/пароль

### Система ключей
- Различные типы ключей:
  - Стандартные (30 дней)
  - Премиум (90 дней)
  - Пожизненные
- Возможность генерации ключей через веб-интерфейс или Discord-бота
- Отслеживание статуса и срока действия ключей
- Время ключа начинает отсчет только после привязки к аккаунту

### Система лоадера
- Загрузка новых версий лоадера через админ-панель
- Несколько типов версий (стабильная, бета, альфа, разработка)
- Скачивание актуальной версии лоадера авторизованными пользователями
- Отслеживание количества скачиваний

### Ролевая модель
- Администраторы: полный доступ к системе, загрузка лоадера
- Модераторы: управление пользователями и генерация ключей
- Поддержка: просмотр статистики и блокировка пользователей
- Пользователи: базовый доступ к системе, привязка ключей

### Интеграция с Discord
- Синхронизация ролей между сайтом и Discord
- Управление ключами через команды бота
- Привязка аккаунтов через временные коды
- Автоматическая выдача/снятие ролей при изменении прав на сайте

### Безопасность
- Запрет множественной регистрации с одного Discord-аккаунта/IP
- Автоматическая проверка ролей Discord при каждом входе
- Шифрование критичных данных в БД

### Логирование
- Отдельные логи для действий пользователей, ошибок системы и модерации
- Интеграция логов с Discord-каналами через webhook

## Установка

### Требования
- Python 3.10+
- PostgreSQL 14+
- Redis 6+
- Nginx (для продакшн)
- Certbot (для HTTPS)

### Быстрый старт
1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/zalupaspb.git
cd zalupaspb
```

2. Запустите скрипт инициализации:
```bash
bash scripts/init.sh
```

3. Отредактируйте конфигурационные файлы:
```bash
nano zalupaspb/config/config.yaml
nano zalupaspb/config/.env
```

4. Запустите веб-приложение:
```bash
cd zalupaspb/web
python manage.py runserver
```

5. Запустите Discord-бота:
```bash
cd zalupaspb/bot
python bot.py
```

## Разработка

### Веб-приложение
Веб-приложение построено на Django и Django REST Framework с использованием:
- PostgreSQL для хранения данных
- Redis для кеширования и WebSocket-соединений
- Channels для WebSocket
- JWT для аутентификации API

### Discord-бот
Бот построен на библиотеке discord.py с использованием:
- Slash-команд (/)
- Интеграции с API веб-приложения
- Системы разрешений на основе ролей

## Документация
Подробная документация доступна в папке `docs/`:
- [Установка и настройка](docs/installation.md)
- [API Reference](docs/api.md)
- [Руководство пользователя](docs/user-guide.md)
- [Руководство администратора](docs/admin-guide.md)

## Лицензия
Этот проект распространяется под закрытой лицензией и предназначен только для внутреннего использования. 
